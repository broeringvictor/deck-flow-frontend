<div class="study-container">
  <h1>Configurar Sessão de Estudo</h1>

  <form [formGroup]="studyForm" (ngSubmit)="startStudying()" class="start-form">
    <mat-form-field appearance="outline">
      <mat-label>Categoria</mat-label>
      <mat-select formControlName="categoryId">
        @for (category of categories(); track category.id) {
          <mat-option [value]="category.id">{{ category.name }}</mat-option>
        }
      </mat-select>
      @if (studyForm.get('categoryId')?.hasError('required')) {
        <mat-error>A categoria é obrigatória.</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Número de Questões</mat-label>
      <input matInput type="number" formControlName="count" min="1" max="50" />
      @if (studyForm.get('count')?.hasError('min')) {
        <mat-error>O número mínimo de questões é 1.</mat-error>
      }
      @if (studyForm.get('count')?.hasError('max')) {
        <mat-error>O número máximo de questões é 50.</mat-error>
      }
    </mat-form-field>

    <button mat-flat-button color="primary" type="submit" [disabled]="studyForm.invalid || isLoading()">
      @if (isLoading()) {
        <mat-progress-spinner mode="indeterminate" diameter="24"></mat-progress-spinner>
        <span class="loading-text">Carregando...</span>
      } @else {
        <span>Iniciar Estudo</span>
      }
    </button>
  </form>

  <div class="cards-section">
    @if (isLoading()) {
    } @else {
      @for (question of questions(); track question.id) {
        <app-question-card
          [questionCard]="question"
          (cardReviewed)="onCardReviewed(question.id)"
        />
      } @empty {
        @if (searchPerformed()) {
          <div class="empty-state">
            <p>Nenhum card encontrado para os critérios selecionados.</p>
          </div>
        }
      }
    }
  </div>
</div>
